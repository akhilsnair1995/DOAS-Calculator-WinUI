<Window
    x:Class="DOASCalculatorWinUI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DOASCalculatorWinUI"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="420"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <MenuBar Grid.Row="0" Grid.ColumnSpan="2">
            <MenuBarItem Title="File"><MenuFlyoutItem Text="Exit" Click="Exit_Click"/></MenuBarItem>
            <MenuBarItem Title="Units">
                <ToggleMenuFlyoutItem x:Name="MenuSI" Text="SI (Metric)" IsChecked="True" Click="Units_Click"/>
                <ToggleMenuFlyoutItem x:Name="MenuIP" Text="IP (Imperial)" Click="Units_Click"/>
            </MenuBarItem>
        </MenuBar>

        <!-- Left Pane: Inputs -->
        <Border Grid.Row="1" Grid.Column="0" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0,0,1,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                <StackPanel Spacing="16">
                    <TextBlock Text="Configuration" Style="{StaticResource TitleTextBlockStyle}"/>

                    <Expander Header="System Mode" IsExpanded="True" HorizontalAlignment="Stretch">
                        <StackPanel Spacing="12">
                            <ComboBox x:Name="CmbSeason" Header="Operation Mode" SelectedIndex="0" SelectionChanged="Input_Changed">
                                <ComboBoxItem Content="Summer (Cooling)"/><ComboBoxItem Content="Winter (Heating)"/>
                            </ComboBox>
                            <NumberBox x:Name="NumAltitude" Header="Altitude" Value="0" ValueChanged="Input_Changed"/>
                        </StackPanel>
                    </Expander>

                    <Expander Header="Airflows" IsExpanded="True" HorizontalAlignment="Stretch">
                        <StackPanel Spacing="12">
                            <NumberBox x:Name="NumOaFlow" Header="OA Flow" Value="1000" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumOaDb" Header="OA DB" Value="35.0" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumOaWb" Header="OA WB" Value="28.0" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumEaFlow" Header="EA Flow" Value="800" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumEaDb" Header="EA DB" Value="24.0" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumEaRh" Header="EA RH (%)" Value="50.0" ValueChanged="Input_Changed"/>
                        </StackPanel>
                    </Expander>

                    <Expander Header="Energy Recovery" HorizontalAlignment="Stretch">
                        <StackPanel Spacing="12">
                            <ToggleSwitch x:Name="TogWheel" Header="Enthalpy Wheel" IsOn="True" Toggled="Input_Changed"/>
                            <NumberBox x:Name="NumWheelSens" Header="Sensible Eff (%)" Value="75" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumWheelLat" Header="Latent Eff (%)" Value="70" ValueChanged="Input_Changed"/>
                            <CheckBox x:Name="ChkEconomizer" Content="Economizer Mode" IsChecked="True" Click="Input_Changed"/>
                        </StackPanel>
                    </Expander>

                    <Expander Header="Passive Recovery (Wrap-around)" HorizontalAlignment="Stretch">
                        <StackPanel Spacing="12">
                            <ToggleSwitch x:Name="TogDw" Header="Dual Wheel (Sensible)" IsOn="False" Toggled="Input_Changed"/>
                            <NumberBox x:Name="NumDwEff" Header="Sensible Eff (%)" Value="65" IsEnabled="{x:Bind TogDw.IsOn, Mode=OneWay}" ValueChanged="Input_Changed"/>
                            <ToggleSwitch x:Name="TogHp" Header="Horse-shoe Heat Pipe" IsOn="False" Toggled="Input_Changed"/>
                            <NumberBox x:Name="NumHpEff" Header="Effectiveness (%)" Value="45" IsEnabled="{x:Bind TogHp.IsOn, Mode=OneWay}" ValueChanged="Input_Changed"/>
                        </StackPanel>
                    </Expander>

                    <Expander Header="Conditioning" HorizontalAlignment="Stretch">
                        <StackPanel Spacing="12">
                            <NumberBox x:Name="NumOffCoil" Header="Off-Coil Temp" Value="12.0" ValueChanged="Input_Changed"/>
                            <ToggleSwitch x:Name="TogReheat" Header="Reheat" IsOn="False" Toggled="Input_Changed"/>
                            <NumberBox x:Name="NumSupplyTemp" Header="Supply Temp" Value="20.0" IsEnabled="{x:Bind TogReheat.IsOn, Mode=OneWay}" ValueChanged="Input_Changed"/>
                        </StackPanel>
                    </Expander>

                    <Expander Header="Fans" HorizontalAlignment="Stretch">
                        <StackPanel Spacing="12">
                            <NumberBox x:Name="NumSupEsp" Header="Supply ESP" Value="500" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumExtEsp" Header="Extract ESP" Value="500" ValueChanged="Input_Changed"/>
                            <NumberBox x:Name="NumFanEff" Header="Fan Eff (%)" Value="60" ValueChanged="Input_Changed"/>
                        </StackPanel>
                    </Expander>
                    
                    <Button Content="Force Calculate" Click="Calculate_Click" Style="{StaticResource AccentButtonStyle}" HorizontalAlignment="Stretch" Margin="0,0,0,20"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Right Pane: Results -->
        <Grid Grid.Row="1" Grid.Column="1" Padding="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid ColumnDefinitions="*,*,*,*" Margin="0,0,0,20">
                <StackPanel Grid.Column="0" Spacing="2">
                    <TextBlock Text="Cooling" Style="{StaticResource CaptionTextBlockStyle}"/>
                    <TextBlock x:Name="ResCooling" Text="0.0 kW" Style="{StaticResource TitleTextBlockStyle}" Foreground="SteelBlue"/>
                    <TextBlock x:Name="ResCoolingBreakdown" Text="S: 0.0 | L: 0.0" FontSize="12" Foreground="Gray"/>
                </StackPanel>
                <StackPanel Grid.Column="1">
                    <TextBlock Text="Heating" Style="{StaticResource CaptionTextBlockStyle}"/>
                    <TextBlock x:Name="ResHeating" Text="0.0 kW" Style="{StaticResource TitleTextBlockStyle}" Foreground="OrangeRed"/>
                </StackPanel>
                <StackPanel Grid.Column="2">
                    <TextBlock Text="Reheat" Style="{StaticResource CaptionTextBlockStyle}"/>
                    <TextBlock x:Name="ResReheat" Text="0.0 kW" Style="{StaticResource TitleTextBlockStyle}" Foreground="DarkMagenta"/>
                </StackPanel>
                <StackPanel Grid.Column="3">
                    <TextBlock Text="Fans" Style="{StaticResource CaptionTextBlockStyle}"/>
                    <TextBlock x:Name="ResFanPower" Text="0.0 kW" Style="{StaticResource TitleTextBlockStyle}"/>
                    <TextBlock x:Name="ResFanBreakdown" Text="S: 0.0 | E: 0.0" FontSize="12" Foreground="Gray"/>
                </StackPanel>
            </Grid>

            <Viewbox Grid.Row="1" Stretch="Uniform">
                <Grid Width="902" Height="652">
                    <Image x:Name="ImgChart" Source="Images/FlyCarpetPsyChart_SI.png" Stretch="Fill"/>
                    <Canvas x:Name="ChartCanvas" Width="902" Height="652"/>
                </Grid>
            </Viewbox>

            <ListView x:Name="ListSchedule" Grid.Row="2" Height="200" Margin="0,10,0,0">
                <ListView.Header>
                    <Grid Padding="8" Background="{ThemeResource LayerFillColorDefaultBrush}"><Grid.ColumnDefinitions><ColumnDefinition Width="150"/><ColumnDefinition Width="*"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions><TextBlock Text="Component" FontWeight="Bold"/><TextBlock Text="Entering" Grid.Column="1" FontWeight="Bold"/><TextBlock Text="Leaving" Grid.Column="2" FontWeight="Bold"/></Grid>
                </ListView.Header>
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="8"><Grid.ColumnDefinitions><ColumnDefinition Width="150"/><ColumnDefinition Width="*"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions><TextBlock Text="{Binding Component}"/><TextBlock Text="{Binding Entering}" Grid.Column="1"/><TextBlock Text="{Binding Leaving}" Grid.Column="2"/></Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</Window>